Data Manipulation with dplyr
============================

# 1. Transforming Data with dplyr

## 1.1 The counties dataset

* Chapter 1 verbs

  * `select()`
  * `filter()`
  * `arrange()`
  * `mutate()`

```R
# take a look at the dataset
glimpse(counties)

# select()
counties %>%
  select(state, county, population, unemployment)
  
# creating a new table
counties_selected <- counties %>%
  select(state, county, population, unemployment)
```

## 1.2 The filter and arragne verbs

* Arrange

```
counties_selected %>%
  arrange(population)
```

* Arrange: descending

```
counties_selected %>%
  arrange(desc(population))
```

* Filter

```
counties_selected %>%
  arrange(desc(population)) %>%
  filter(state == "New York")
  
counties_selected %>%
  arrange(desc(population)) %>%
  filter(unemployment < 6)
```

* Combining conditions

```
counties_selected %>%
	arrange(desc(population)) %>%
	filter(state == "New York", unemployment < 6)
```

## 1.3 Mutate

* Mutate

```
counties_selected %>%
	mutate(unemployed_population = population * unemployment / 100) %>%
	arrange(desc(unemployed_population))
```

# 2. Aggregating Data

## 2.1 The count verb

```
counties %>%
	count()
```

* Count variable

```
counties %>%
	count(state)
```

* Count and sort

```
counties %>%
	count(state, sort= TRUE)
```

* Add weight

```
counties %>%
	count(state, wt = population, sort = TRUE)
```

## 2.2 The group by, summarize and ungroup verbs

* Summarize

```
counties %>%
	summarize(total_population = sum(population))
```

* Aggregate and summarize

```
counties %>%
	summarize(total_population = sum(population),
		average_unemployment = mean(unemployment))
```

* Summary functions

		* `sum()`
		* `mean()`
		* `median()`
		* `min()` : maximum
		* `max()` : minimum
		* `n()` : size of the group

* Aggregate within groups

```
counties %>%
	group_by(state) %>%
	summarize(total_pop = sum(population),
		averge_unemployment = mean(unemployment))
```

* Arrange

```
counties %>%
	group_by(state) %>%
	summarize(total_pop = sum(population),
		average_unemployment = mean(unemployment)) %>%
	arrange(desc(average_unemployment))
```

* Metro column

```
counties %>%
	select(state, metro, county, population)
```

* Group by

```
counties %>%
	group_by(state, metro) %>%
	summarize(total_pop = sum(population))
```

* Ungroup

```
counties %>%
	group_by(state, metro) %>%
	summarize(total_pop = sum(population))
	ungroup()
```

## 2.3 The top_n verb

* `top_n`

```
counties_selected <- counties %>%
	select(state, county, population, unemployment, income)
	
# get the county with the highest population from each state
counties_selected %>%
	group_by(state) %>%
	top_n(1, population)
	
# get the top three counties with the highest population from each state
counties_selected %>%
	group_by(state) %>%
	top_n(3, population)
```

# 3. Selecting and Transforming Data

## 3.1 Selecting

* Select a range with `:`

```
counties %>%
	select(state, county, drive:work_at_home) %>%
	arrange(drive)
```

* `contains()`

```
counties %>%
	select(state, county, contains("work"))
```

* `starts_with()`

```
counties %>%
	select(state, county, starts_with("income))
```

* `ends_with()`

* `last_col()`

* For more: `?select_helpers`

* Removing a variable with minus `-`

```
counties %>%
	select(-census_id)
```

## 3.2 The rename verb

* Rename a column

```
counties_selected %>%
	rename(unemployment_rate = unemployment)
```

* Combine verbs

```
counties_selected %>%
	select(state, county, population, unemployment_rate = unemployment)
```

* Compare verbs

```
# select
counties %>%
	select(state, county, population, unemployment_rate = unemployment)
	
# rename
counties %>%
	select(state, county, population, unemployment) %>%
	rename(unemployment_rate = unemployment)
```

## 3.3 The transmute verb

* Transmute

		* Combination: select & mutate
		* Returns a subset of columns that are transformed and changed

* Select and calculate

```
counties %>%
	transmute(state, county, fraction_men = men / population)
```

* Summary

|                   | Keeps only specified variables | Keeps other variables|
|:-----------------:|:------------------------------:|:--------------------:|
|Can't change values| select()                       | rename()             |
|Can change values  | transmute()                    | mutate()             |


# 4. Case Study: The babynames Dataset

## 4.1 The babynames data

```
library(ggplot2)
baby







## 4.2 Grouped mutates




## 4.3 Window functions



	











